 food-track

**–ù–∞–∑–≤–∞–Ω–∏–µ**: FoodTrack ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Ñ—É–¥-—Å—Ç–∞—Ä—Ç–∞–ø–∞

–î–µ–ª–∞–µ–º **Event Tracker –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã** —Å –¥–≤—É–º—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏: **–ø–∏—Ü—Ü–∞** –∏ **–±—É—Ä–≥–µ—Ä—ã**.  
–¶–µ–ª—å ‚Äî –ø–æ–Ω—è—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏–∑–º–µ—Ä–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–æ—Ä–æ–Ω–∫–∏:  
**–æ—Ç–∫—Ä—ã—Ç–∏–µ ‚Üí –ø—Ä–æ—Å–º–æ—Ç—Ä ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É ‚Üí –∑–∞–∫–∞–∑**.

–ü–ª–∞–Ω –¥–ª—è MVP:
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è** ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è, —Å `properties` –∫–∞–∫ JSON.
- **–ù–∞–±–æ—Ä –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π** ‚Äî —Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ, —Å–∫–æ–ª—å–∫–æ –Ω—É–∂–Ω–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.
- **–ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å** ‚Äî PostgreSQL + JSONB.
- **–ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ —Å—á–∏—Ç–∞—Ç—å** ‚Äî DAU, –≤–æ—Ä–æ–Ω–∫–∞, –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å.
- **–î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ**: —Å–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∏—Ç N –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ü–µ–ø–æ—á–∫–∞–º–∏ —Å–æ–±—ã—Ç–∏–π.

---

## üß± 1. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è (Event)

–ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–µ–¥–∏–Ω—ã–π –≥–∏–±–∫–∏–π —Ñ–æ—Ä–º–∞—Ç**, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.

### JSON-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (—Ç–æ, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞ `/track`):
```json
{
  "eventType": "screen_viewed",
  "userId": "user_789",
  "sessionId": "sess_abc123",
  "timestamp": "2024-05-20T18:42:10Z",
  "properties": {
    "screen": "menu",
    "category": "pizza"
  }
}
```

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|--------|
| `eventType` | string | –ù–∞–∑–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è (`screen_viewed`, `item_added`, –∏ —Ç.–¥.) |
| `userId` | string | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–µ—Å–ª–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚Äî –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π) |
| `sessionId` | string | ID —Å–µ—Å—Å–∏–∏ (–ø–æ–ª–µ–∑–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—É—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) |
| `timestamp` | ISO 8601 | –í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è (–ª—É—á—à–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ) |

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è (–≤ `properties` ‚Äî `Map<String, Object>`):
- –õ—é–±—ã–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ: `item_id`, `price`, `category`, `screen`, `error_code` –∏ —Ç.–¥.

> üí° –í Java –±—É–¥–µ–º —Ö—Ä–∞–Ω–∏—Ç—å `properties` –∫–∞–∫ `Map<String, Object>`, –∞ –≤ PostgreSQL ‚Äî –∫–∞–∫ `JSONB`.

---

## üìã 2. –ö–∞–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å?

–î–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤–æ—Ä–æ–Ω–∫–∏ –∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ **5‚Äì6 –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π**:

| –°–æ–±—ã—Ç–∏–µ (`eventType`) | –ö–æ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è | –ü—Ä–∏–º–µ—Ä `properties` |
|------------------------|-------------------|----------------------|
| `app_opened` | –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | `{ "platform": "android", "version": "1.2.0" }` |
| `screen_viewed` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–ª —ç–∫—Ä–∞–Ω | `{ "screen": "menu", "category": "pizza" }` |
| `item_viewed` | –û—Ç–∫—Ä—ã–ª –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ | `{ "item_id": "pizza_pepperoni", "category": "pizza", "price": 599 }` |
| `item_added_to_cart` | –î–æ–±–∞–≤–∏–ª –≤ –∫–æ—Ä–∑–∏–Ω—É | `{ "item_id": "burger_classic", "category": "burger", "quantity": 2 }` |
| `checkout_started` | –ü–µ—Ä–µ—à—ë–ª –∫ –æ–ø–ª–∞—Ç–µ | `{ "cart_total": 1198, "items_count": 2 }` |
| `order_placed` | –£—Å–ø–µ—à–Ω–æ –∑–∞–∫–∞–∑–∞–ª | `{ "order_id": "ord_12345", "total": 1198, "payment_method": "card" }` |
| `payment_failed` | –û–ø–ª–∞—Ç–∞ –Ω–µ –ø—Ä–æ—à–ª–∞ | `{ "error_code": "card_declined", "order_id": "ord_12345" }` |

> ‚úÖ –≠—Ç–∏—Ö —Å–æ–±—ã—Ç–∏–π –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –ø–æ—Å—Ç—Ä–æ–∏—Ç—å:
> - –í–æ—Ä–æ–Ω–∫—É –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
> - –ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –ø–∏—Ü—Ü vs –±—É—Ä–≥–µ—Ä–æ–≤
> - –°—Ä–µ–¥–Ω–∏–π —á–µ–∫
> - –ü—Ä–æ–±–ª–µ–º—ã —Å –æ–ø–ª–∞—Ç–æ–π

---

## üóÉ 3. –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å –≤ –±–∞–∑–µ (PostgreSQL)

–¢–∞–±–ª–∏—Ü–∞ `events`:

```sql
CREATE TABLE events (
    id BIGSERIAL PRIMARY KEY,
    event_type VARCHAR(100) NOT NULL,
    user_id VARCHAR(100) NOT NULL,
    session_id VARCHAR(100) NOT NULL,
    timestamp TIMESTAMPTZ NOT NULL,
    properties JSONB
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
CREATE INDEX idx_events_type_time ON events (event_type, timestamp);
CREATE INDEX idx_events_user ON events (user_id);
CREATE INDEX idx_events_props_category ON events ((properties->>'category'));
```

> üí° `JSONB` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤—Ä–æ–¥–µ:
> ```sql
> SELECT COUNT(*) FROM events 
> WHERE event_type = 'item_viewed' 
>   AND (properties->>'category') = 'pizza';
> ```

---

## üìä 4. –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –º–æ–∂–Ω–æ —Å—Ç—Ä–æ–∏—Ç—å?

–ù–∞ –æ—Å–Ω–æ–≤–µ —ç—Ç–∏—Ö —Å–æ–±—ã—Ç–∏–π:

1. **DAU**:
   ```sql
   SELECT COUNT(DISTINCT user_id) 
   FROM events 
   WHERE event_type = 'app_opened' 
     AND timestamp >= '2024-05-20';
   ```

2. **–í–æ—Ä–æ–Ω–∫–∞ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏** (pizza):
    - –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–≤—à–∏–µ –ø–∏—Ü—Ü—É ‚Üí –¥–æ–±–∞–≤–∏–≤—à–∏–µ ‚Üí –∑–∞–∫–∞–∑–∞–≤—à–∏–µ.

3. **–¢–û–ü-5 –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –±–ª—é–¥**:
   ```sql
   SELECT properties->>'item_id' AS item, COUNT(*) 
   FROM events 
   WHERE event_type = 'item_viewed' 
   GROUP BY item 
   ORDER BY COUNT DESC 
   LIMIT 5;
   ```

4. **–ö–æ–Ω–≤–µ—Ä—Å–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã –≤ –∑–∞–∫–∞–∑**:  
   `(—á–∏—Å–ª–æ order_placed) / (—á–∏—Å–ª–æ checkout_started) * 100%`

---

## üì± 5. –ö–∞–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–±—ã—Ç–∏—è?

–ü—Ä–∏–º–µ—Ä –Ω–∞ Kotlin (Android) –∏–ª–∏ Swift (iOS), –Ω–æ –ª–æ–≥–∏–∫–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è:

```kotlin
fun track(eventType: String, properties: Map<String, Any>) {
    val event = mapOf(
        "eventType" to eventType,
        "userId" to getCurrentUserId(),
        "sessionId" to getCurrentSessionId(),
        "timestamp" to Instant.now().toString(),
        "properties" to properties
    )
    api.post("/track", event)
}
```

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
```kotlin
track("item_viewed", mapOf(
    "item_id" to "pizza_margarita",
    "category" to "pizza",
    "price" to 499
))
```
